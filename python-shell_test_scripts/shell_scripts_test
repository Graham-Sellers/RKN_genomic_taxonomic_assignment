# tests in shell

# path is only here to allow for ease of wrangling from secondary HDD
path=/media/graham/Storage/nems/

################################################################################
# FASTQ TO FASTA
# converting fastq to fasta format (just incase this is easier than using straight fastq)

path=/media/graham/Storage/nems/

samples=$(ls $path/nanopore_test_data/01_nanopore_fastq_HAC_barcode_qfilterpass/ | grep '.fastq' | sed 's/.fastq//')

echo -e $samples

for sample in $samples
do
seqkit fq2fa $path/nanopore_test_data/01_nanopore_fastq_HAC_barcode_qfilterpass/${sample}.fastq \
-o $path/nanopore_test_data/02_nanopore_fasta_HAC_barcode_qfilterpass/${sample}.fasta
done

################################################################################
# KRAKEN2 FASTA INPUT
# using fasta input for Kraken2 with a small confidence value (0.01)

path=/media/graham/Storage/nems

mkdir $path/nanopore_test_data/output/HAC_fasta_input/kraken2_standard

files=$(ls $path/nanopore_test_data/02_nanopore_fasta_HAC_barcode_qfilterpass/ | sed 's/.fasta//')

for a in $files
do
kraken2 --db $path/meloidogyne_dbs/meloidogyne_db \
$path/nanopore_test_data/02_nanopore_fasta_HAC_barcode_qfilterpass/${a}.fasta \
--use-names \
--memory-mapping \
--threads 10 \
--confidence 0.01 \
--output $path/nanopore_test_data/output/HAC_fasta_input/kraken2_standard/${a}.tsv \
--report $path/nanopore_test_data/output/HAC_fasta_input/kraken2_standard/${a}.txt
done

################################################################################
# KRAKEN2 FASTQ INPUT
# using fastq input for Kraken2 with a small confidence value (0.01)
# additionally uses --minimum-base-quality 10 (another level of quality control)
# bases/reads below this quality are ignored for taxonomic assignment

path=/media/graham/Storage/nems

mkdir $path/nanopore_test_data/output/HAC_fastq_input/kraken2_standard

files=$(ls nanopore_test_data/01_nanopore_fastq_HAC_barcode_qfilterpass/ | sed 's/.fastq//')

for a in $files
do
kraken2 --db $path/meloidogyne_dbs/meloidogyne_db \
$path/nanopore_test_data/01_nanopore_fastq_HAC_barcode_qfilterpass/${a}.fastq \
--minimum-base-quality 10 \
--use-names \
--memory-mapping \
--threads 10 \
--confidence 0.01 \
--output $path/nanopore_test_data/output/HAC_fastq_input/kraken2_standard/${a}.tsv \
--report $path/nanopore_test_data/output/HAC_fastq_input/kraken2_standard/${a}.txt
done
